<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YSM - YouTube Subs Monetization</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-storage-compat.js"></script>
    
    <style>
        /* ... (all the previous CSS styles remain exactly the same) ... */
        :root {
            --primary-red: #E50914;
            --dark-red: #b80710;
            --black: #000000;
            --dark-gray: #0a0a0a;
            --medium-gray: #1a1a1a;
            --light-gray: #333333;
            --white: #ffffff;
            --success: #00ff00;
            --warning: #ffa500;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--black);
            color: var(--white);
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* ... (all other CSS styles remain the same) ... */
    </style>
</head>
<body>

<!-- Loader Screen -->
<style>
#loader-wrap{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;flex-direction:column;background:#fff;z-index:99999;transition:opacity 1.5s ease}
.play-icon{width:96px;height:96px;display:flex;align-items:center;justify-content:center}
.play-icon svg{width:64px;height:64px;fill:#FF0000}
.loader-bar{width:240px;height:6px;background:rgba(0,0,0,0.08);border-radius:6px;margin-top:18px;overflow:hidden;position:relative}
.loader-progress{position:absolute;left:50%;right:50%;height:100%;background:#FF0000;transform-origin:center;transition:width 0.2s linear,left 0.2s linear,right 0.2s linear}
</style>
<div id="loader-wrap">
  <div class="play-icon"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 22V2l18 10L3 22z"></path></svg></div>
  <div class="loader-bar"><div id="loader-progress" class="loader-progress" style="left:50%;right:50%;width:0%"></div></div>
</div>

    <!-- Loading Spinner -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <p>Processing...</p>
    </div>

    <!-- Hidden Admin Access -->
    <button class="admin-access" onclick="showPage('admin-login-page')" title="Admin Access"></button>

    <!-- Landing Page -->
    <div id="landing-page" class="page active">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <i class="fab fa-youtube"></i> YSM
                    </div>
                    <div class="auth-buttons">
                        <button class="btn btn-outline" onclick="showPage('login-page')">Login</button>
                        <button class="btn btn-primary" onclick="showPage('register-page')">Join YSM</button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Hero Section -->
        <section style="background: linear-gradient(135deg, var(--black) 0%, var(--primary-red) 100%); padding: 180px 0 100px; text-align: center;">
            <div class="container">
                <h1 style="font-size: 3.5rem; margin-bottom: 25px;">üåç Welcome to YSM ‚Äî Where Attention Becomes Wealth</h1>
                <p style="font-size: 1.3rem; max-width: 800px; margin: 0 auto 30px;">
                    In the digital world, attention is the new currency. Every like, every view, every click has value ‚Äî but for years, that value has only flowed in one direction: away from the users who create it. YSM (YouTube Subs Monetization) was built to change that.
                </p>
                <div class="auth-buttons">
                    <button class="btn btn-primary btn-3d" style="font-size: 1.2rem; padding: 15px 35px;" onclick="showPage('register-page')">
                        Join YSM Now
                    </button>
                    <button class="btn btn-outline btn-3d" style="font-size: 1.2rem; padding: 15px 35px;" onclick="showPage('login-page')">
                        Log In to Start Earning
                    </button>
                </div>
            </div>
        </section>

        <!-- How It Works -->
        <section class="marketing-section" style="background: var(--dark-gray);">
            <div class="container">
                <h2 style="text-align: center; font-size: 2.5rem; margin-bottom: 30px;">üíº How It Works ‚Äî Partnership, Not Payment</h2>
                <p style="text-align: center; font-size: 1.2rem; max-width: 900px; margin: 0 auto 40px;">
                    Every activation tier represents your digital partnership level in the YSM ecosystem. Your contribution helps power sponsored ad campaigns, influencer collaborations, and marketing operations that feed our global reward pool. As the system grows, so does your share of the flow. Each task you complete helps boost platform engagement, attract new sponsors, and increase your potential rewards.
                </p>
                <p style="text-align: center; font-size: 1.2rem; max-width: 900px; margin: 0 auto 40px; color: var(--primary-red); font-weight: bold;">
                    üí° Think of it as turning your time online into a growing digital asset.
                </p>
                <div class="feature-grid">
                    <div class="feature-card smooth-3d">
                        <div class="feature-icon">üìù</div>
                        <h3 style="margin-bottom: 15px;">1. Register</h3>
                        <p>Create your account in seconds with our secure registration process</p>
                    </div>
                    <div class="feature-card smooth-3d">
                        <div class="feature-icon">üîí</div>
                        <h3 style="margin-bottom: 15px;">2. Complete KYC</h3>
                        <p>Verify your identity with our secure and fast KYC process</p>
                    </div>
                    <div class="feature-card smooth-3d">
                        <div class="feature-icon">üí∞</div>
                        <h3 style="margin-bottom: 15px;">3. Watch & Earn</h3>
                        <p>Get paid for watching sponsored YouTube videos and subscribing</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Success Stories -->
        <section class="marketing-section" style="background: var(--black);">
            <div class="container">
                <h2 style="text-align: center; font-size: 2.5rem; margin-bottom: 50px;">üåü Success Stories</h2>
                <div class="testimonial-grid">
                    <div class="testimonial-card">
                        <div class="testimonial-avatar">JD</div>
                        <h3 style="margin-bottom: 10px;">John D. - New York</h3>
                        <p style="color: var(--success); margin-bottom: 10px;">Earned $1,250 in 3 months</p>
                        <p>"I was skeptical at first, but YSM has completely changed how I earn online. The platform is easy to use and payments are always on time. I've upgraded to the $769.23 tier and my earnings have tripled!"</p>
                    </div>
                    <div class="testimonial-card">
                        <div class="testimonial-avatar">SM</div>
                        <h3 style="margin-bottom: 10px;">Sarah M. - London</h3>
                        <p style="color: var(--success); margin-bottom: 10px;">Earned $2,800 in 6 months</p>
                        <p>"As a student, YSM has been a game-changer. I can earn while studying. The tier system really works! I started with the basic tier and now I'm at the $1,692.31 level. The compound growth is incredible."</p>
                    </div>
                    <div class="testimonial-card">
                        <div class="testimonial-avatar">RK</div>
                        <h3 style="margin-bottom: 10px;">Robert K. - Nairobi</h3>
                        <p style="color: var(--success); margin-bottom: 10px;">Earned $5,100 in 1 year</p>
                        <p>"The referral program is amazing. I've built a team of 15 people and earn passive income from their activities. YSM has given me financial freedom I never thought possible."</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tier Table -->
        <section class="marketing-section" style="background: var(--dark-gray);">
            <div class="container">
                <h2 style="text-align: center; font-size: 2.5rem; margin-bottom: 50px;">Investment Tiers</h2>
                <div class="tier-table-container" style="overflow-x: auto;">
                    <table class="tier-table">
                        <thead>
                            <tr>
                                <th>Tier</th>
                                <th>Ads/Day</th>
                                <th>Pay/Ad</th>
                                <th>Daily</th>
                                <th>Monthly</th>
                                <th>6-Month</th>
                                <th>1-Year</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>$115.38</td><td>8</td><td>$0.48</td><td>$3.85</td><td>$115.38</td><td>$692.31</td><td>$1,384.62</td></tr>
                            <tr><td>$192.31</td><td>10</td><td>$0.64</td><td>$6.41</td><td>$192.31</td><td>$1,153.85</td><td>$2,307.69</td></tr>
                            <tr><td>$269.23</td><td>12</td><td>$0.75</td><td>$8.97</td><td>$269.23</td><td>$1,615.38</td><td>$3,230.77</td></tr>
                            <tr><td>$307.69</td><td>13</td><td>$0.79</td><td>$10.26</td><td>$307.69</td><td>$1,846.15</td><td>$3,692.31</td></tr>
                            <tr><td>$461.54</td><td>15</td><td>$1.03</td><td>$15.38</td><td>$461.54</td><td>$2,769.23</td><td>$5,538.46</td></tr>
                            <tr><td>$615.38</td><td>17</td><td>$1.21</td><td>$20.51</td><td>$615.38</td><td>$3,692.31</td><td>$7,384.62</td></tr>
                            <tr><td>$769.23</td><td>18</td><td>$1.43</td><td>$25.64</td><td>$769.23</td><td>$4,615.38</td><td>$9,230.77</td></tr>
                            <tr><td>$923.08</td><td>20</td><td>$1.54</td><td>$30.77</td><td>$923.08</td><td>$5,538.46</td><td>$11,076.92</td></tr>
                            <tr><td>$1,692.31</td><td>25</td><td>$2.26</td><td>$56.41</td><td>$1,692.31</td><td>$10,153.85</td><td>$20,307.69</td></tr>
                            <tr><td>$2,461.54</td><td>30</td><td>$2.74</td><td>$82.05</td><td>$2,461.54</td><td>$14,769.23</td><td>$29,538.46</td></tr>
                            <tr><td>$3,230.77</td><td>35</td><td>$3.08</td><td>$107.69</td><td>$3,230.77</td><td>$19,384.62</td><td>$38,769.23</td></tr>
                            <tr><td>$4,000.00</td><td>40</td><td>$3.33</td><td>$133.33</td><td>$4,000.00</td><td>$24,000.00</td><td>$48,000.00</td></tr>
                            <tr><td>$4,615.38</td><td>45</td><td>$3.42</td><td>$153.85</td><td>$4,615.38</td><td>$27,692.31</td><td>$55,384.62</td></tr>
                        </tbody>
                    </table>
                </div>
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-primary btn-3d" onclick="showPage('register-page')">Start Earning Now</button>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer style="background: var(--black); padding: 40px 0; border-top: 1px solid var(--glass-border);">
            <div class="container">
                <div style="text-align: center;">
                    <p>&copy; 2024 YSM - YouTube Subs Monetization. All rights reserved.</p>
                    <div style="margin-top: 20px;">
                        <a href="#" style="color: var(--white); margin: 0 10px;">Terms</a>
                        <a href="#" style="color: var(--white); margin: 0 10px;">Privacy</a>
                        <a href="#" style="color: var(--white); margin: 0 10px;">Contact</a>
                        <a href="#" style="color: var(--white); margin: 0 10px;">Support</a>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Registration Page -->
    <div id="register-page" class="page form-container">
        <h2 class="form-title">Join YSM</h2>
        <div class="form-group">
            <input type="text" class="form-control" id="reg-name" placeholder="Full Name" required>
        </div>
        <div class="form-group">
            <input type="email" class="form-control" id="reg-email" placeholder="Email Address" required>
        </div>
        <div class="form-group">
            <input type="password" class="form-control" id="reg-password" placeholder="Password" required>
        </div>
        <div class="form-group">
            <input type="password" class="form-control" id="reg-confirm-password" placeholder="Confirm Password" required>
        </div>
        <div class="form-group">
            <button class="btn btn-primary" style="width: 100%;" onclick="registerUser()">Create Account</button>
        </div>
        <div style="text-align: center;">
            <p>Already have an account? <a href="#" onclick="showPage('login-page')" style="color: var(--primary-red);">Login here</a></p>
        </div>
    </div>

    <!-- Login Page -->
    <div id="login-page" class="page form-container">
        <h2 class="form-title">Login to YSM</h2>
        <div class="form-group">
            <input type="email" class="form-control" id="login-email" placeholder="Email Address" required>
        </div>
        <div class="form-group">
            <input type="password" class="form-control" id="login-password" placeholder="Password" required>
        </div>
        <div class="form-group">
            <button class="btn btn-primary" style="width: 100%;" onclick="loginUser()">Login</button>
        </div>
        <div style="text-align: center;">
            <p>Don't have an account? <a href="#" onclick="showPage('register-page')" style="color: var(--primary-red);">Register here</a></p>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard-page" class="page">
        <div class="top-bar">
            <div class="logo">
                <i class="fab fa-youtube"></i> YSM
            </div>
            <div>
                <span id="user-name" style="margin-right: 15px;"></span>
                <button class="btn btn-outline" onclick="logout()">Logout</button>
            </div>
        </div>

        <div class="dashboard">
            <!-- Wallet Card -->
            <div class="wallet-card">
                <h3>Your Wallet</h3>
                <div class="wallet-balance" id="wallet-balance">$0.00</div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-primary" onclick="showPage('withdraw-page')">Withdraw</button>
                    <button class="btn btn-outline" onclick="showPage('tier-page')">Upgrade Tier</button>
                </div>
            </div>

            <!-- Stats -->
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 20px;">
                <div class="glassmorphism" style="padding: 20px; text-align: center;">
                    <h4>Tasks Completed</h4>
                    <p style="font-size: 1.5rem; color: var(--success);" id="tasks-completed">0</p>
                </div>
                <div class="glassmorphism" style="padding: 20px; text-align: center;">
                    <h4>Current Tier</h4>
                    <p style="font-size: 1.5rem; color: var(--primary-red);" id="current-tier">Starter</p>
                </div>
                <div class="glassmorphism" style="padding: 20px; text-align: center;">
                    <h4>KYC Status</h4>
                    <p id="kyc-status" class="badge badge-pending">Pending</p>
                </div>
            </div>

            <!-- Tasks -->
            <div style="margin: 20px;">
                <h3 style="margin-bottom: 15px;">Available Tasks</h3>
                <div id="tasks-container">
                    <!-- Tasks will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <a class="nav-item active" onclick="showPage('dashboard-page')">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a class="nav-item" onclick="showPage('tasks-page')">
                <i class="fas fa-tasks"></i>
                <span>Tasks</span>
            </a>
            <a class="nav-item" onclick="showPage('tier-page')">
                <i class="fas fa-chart-line"></i>
                <span>Tiers</span>
            </a>
            <a class="nav-item" onclick="showPage('profile-page')">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </a>
        </div>
    </div>

    <!-- Tasks Page -->
    <div id="tasks-page" class="page">
        <div class="top-bar">
            <div class="logo">
                <i class="fas fa-arrow-left" onclick="showPage('dashboard-page')" style="cursor: pointer;"></i>
                <span style="margin-left: 10px;">Tasks</span>
            </div>
            <div>
                <span id="user-name-tasks"></span>
            </div>
        </div>

        <div class="dashboard">
            <div style="margin: 20px;">
                <h2>Available Tasks</h2>
                <p style="margin-bottom: 20px;">Watch videos and subscribe to channels to earn money</p>
                
                <div id="tasks-list">
                    <!-- Tasks will be loaded here -->
                </div>
            </div>
        </div>

        <div class="bottom-nav">
            <a class="nav-item" onclick="showPage('dashboard-page')">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a class="nav-item active" onclick="showPage('tasks-page')">
                <i class="fas fa-tasks"></i>
                <span>Tasks</span>
            </a>
            <a class="nav-item" onclick="showPage('tier-page')">
                <i class="fas fa-chart-line"></i>
                <span>Tiers</span>
            </a>
            <a class="nav-item" onclick="showPage('profile-page')">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </a>
        </div>
    </div>

    <!-- Withdraw Page -->
    <div id="withdraw-page" class="page">
        <div class="top-bar">
            <div class="logo">
                <i class="fas fa-arrow-left" onclick="showPage('dashboard-page')" style="cursor: pointer;"></i>
                <span style="margin-left: 10px;">Withdraw Funds</span>
            </div>
            <div>
                <span id="user-name-withdraw"></span>
            </div>
        </div>

        <div class="dashboard">
            <div class="wallet-card">
                <h3>Withdraw Funds</h3>
                <p style="margin-bottom: 20px;">Available Balance: <span id="withdraw-balance" style="font-weight: bold; color: var(--success);">$0.00</span></p>
                
                <div class="form-group">
                    <label>Amount to Withdraw</label>
                    <input type="number" class="form-control" id="withdraw-amount" placeholder="Enter amount">
                </div>
                
                <div class="form-group">
                    <label>Payment Method</label>
                    <div class="payment-methods">
                        <div class="payment-method" onclick="selectPaymentMethod(this, 'paypal')">
                            <i class="fab fa-paypal" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p>PayPal</p>
                        </div>
                        <div class="payment-method" onclick="selectPaymentMethod(this, 'bank')">
                            <i class="fas fa-university" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p>Bank Transfer</p>
                        </div>
                        <div class="payment-method" onclick="selectPaymentMethod(this, 'crypto')">
                            <i class="fab fa-bitcoin" style="font-size: 2rem; margin-bottom: 10px;"></i>
                            <p>Crypto</p>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Payment Details</label>
                    <input type="text" class="form-control" id="payment-details" placeholder="Enter payment details">
                </div>
                
                <div class="form-group">
                    <button class="btn btn-primary" style="width: 100%;" onclick="processWithdrawal()">Withdraw Funds</button>
                </div>
            </div>
        </div>

        <div class="bottom-nav">
            <a class="nav-item" onclick="showPage('dashboard-page')">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a class="nav-item" onclick="showPage('tasks-page')">
                <i class="fas fa-tasks"></i>
                <span>Tasks</span>
            </a>
            <a class="nav-item" onclick="showPage('tier-page')">
                <i class="fas fa-chart-line"></i>
                <span>Tiers</span>
            </a>
            <a class="nav-item" onclick="showPage('profile-page')">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </a>
        </div>
    </div>

    <!-- Admin Login -->
    <div id="admin-login-page" class="page form-container">
        <h2 class="form-title">Admin Access</h2>
        <div class="form-group">
            <input type="text" class="form-control" id="admin-email" placeholder="Admin Email" required>
        </div>
        <div class="form-group">
            <input type="password" class="form-control" id="admin-password" placeholder="Admin Password" required>
        </div>
        <div class="form-group">
            <button class="btn btn-primary" style="width: 100%;" onclick="adminLogin()">Access Admin Panel</button>
        </div>
    </div>

    <script>
        // ==================== FIREBASE CONFIGURATION ====================
        const firebaseConfig = {
            apiKey: "AIzaSyDOKJQayF5j5xCp6LVZEEFFJH0QiQtezgg",
            authDomain: "sm-platform-6ef20.firebaseapp.com",
            projectId: "sm-platform-6ef20",
            storageBucket: "sm-platform-6ef20.firebasestorage.app",
            messagingSenderId: "485407332553",
            appId: "1:485407332553:web:77bd1bf2b3146486e51518"
        };

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("Firebase initialized successfully");
        } catch (error) {
            console.log("Firebase initialization error:", error);
        }

        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // ==================== APPLICATION STATE ====================
        let currentUser = null;
        let userData = null;
        let selectedPaymentMethod = null;

        // ==================== AUTHENTICATION FUNCTIONS ====================
        
        // Firebase Authentication Registration
        async function registerUser() {
            const name = document.getElementById('reg-name').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-password').value;
            const confirmPassword = document.getElementById('reg-confirm-password').value;

            if (!name || !email || !password) {
                alert('Please fill in all fields');
                return;
            }

            if (password !== confirmPassword) {
                alert('Passwords do not match!');
                return;
            }

            if (password.length < 6) {
                alert('Password must be at least 6 characters long');
                return;
            }

            showLoading(true);

            try {
                // Create user with Firebase Authentication
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                currentUser = userCredential.user;

                // Create user document in Firestore
                await db.collection('users').doc(currentUser.uid).set({
                    name: name,
                    email: email,
                    balance: 0,
                    tier: 'starter',
                    kycStatus: 'pending',
                    tasksCompleted: 0,
                    joinedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                });

                // Send email verification
                await currentUser.sendEmailVerification();

                showLoading(false);
                showSuccess('Registration successful! Please check your email for verification.');
                showPage('dashboard-page');
                
                // Load user data
                await loadUserData();

            } catch (error) {
                showLoading(false);
                console.error('Registration error:', error);
                showError('Registration failed: ' + error.message);
            }
        }

        // Firebase Authentication Login
        async function loginUser() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;

            if (!email || !password) {
                alert('Please enter email and password');
                return;
            }

            showLoading(true);

            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                currentUser = userCredential.user;
                
                // Update last login time
                await db.collection('users').doc(currentUser.uid).update({
                    lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                });

                showLoading(false);
                showSuccess('Login successful!');
                showPage('dashboard-page');
                
                // Load user data
                await loadUserData();

            } catch (error) {
                showLoading(false);
                console.error('Login error:', error);
                showError('Login failed: ' + error.message);
            }
        }

        async function logout() {
            try {
                await auth.signOut();
                currentUser = null;
                userData = null;
                showPage('landing-page');
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        // Load user data from Firestore
        async function loadUserData() {
            if (!currentUser) return;

            try {
                const doc = await db.collection('users').doc(currentUser.uid).get();
                if (doc.exists) {
                    userData = doc.data();
                    updateUIWithUserData();
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // Firebase Auth State Listener
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                console.log('User is signed in:', user.email);
                await loadUserData();
                showPage('dashboard-page');
            } else {
                currentUser = null;
                userData = null;
                console.log('User is signed out');
                showPage('landing-page');
            }
        });

        // ==================== UI FUNCTIONS ====================
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.style.display = 'none';
            });
            
            // Show the selected page
            document.getElementById(pageId).style.display = 'block';
            
            // Update navigation active states
            updateNavigation(pageId);
            
            // Load page-specific data
            loadPageData(pageId);
        }

        function updateNavigation(pageId) {
            // Update bottom navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Set active state based on page
            if (pageId === 'dashboard-page') {
                document.querySelectorAll('.nav-item')[0].classList.add('active');
            } else if (pageId === 'tasks-page') {
                document.querySelectorAll('.nav-item')[1].classList.add('active');
            } else if (pageId === 'tier-page') {
                document.querySelectorAll('.nav-item')[2].classList.add('active');
            } else if (pageId === 'profile-page') {
                document.querySelectorAll('.nav-item')[3].classList.add('active');
            }
        }

        function loadPageData(pageId) {
            if (pageId === 'dashboard-page') {
                updateDashboard();
            } else if (pageId === 'tasks-page') {
                loadTasks();
            } else if (pageId === 'withdraw-page') {
                updateWithdrawPage();
            }
        }

        function updateUIWithUserData() {
            if (!userData) return;

            // Update user name in all locations
            document.querySelectorAll('#user-name, #user-name-tasks, #user-name-withdraw').forEach(element => {
                element.textContent = userData.name;
            });

            // Update wallet balance
            document.getElementById('wallet-balance').textContent = '$' + (userData.balance || 0).toFixed(2);
            document.getElementById('withdraw-balance').textContent = '$' + (userData.balance || 0).toFixed(2);

            // Update tasks completed
            document.getElementById('tasks-completed').textContent = userData.tasksCompleted || 0;

            // Update current tier
            document.getElementById('current-tier').textContent = userData.tier || 'starter';

            // Update KYC status
            const kycStatusElement = document.getElementById('kyc-status');
            kycStatusElement.textContent = userData.kycStatus || 'pending';
            kycStatusElement.className = 'badge badge-' + (userData.kycStatus || 'pending');
        }

        function updateDashboard() {
            loadTasksForDashboard();
        }

        function loadTasksForDashboard() {
            const tasksContainer = document.getElementById('tasks-container');
            tasksContainer.innerHTML = `
                <div class="task-card">
                    <h3>Watch YouTube Video</h3>
                    <p>Watch this video for 30 seconds to earn $0.50</p>
                    <button class="btn btn-primary" onclick="startTask('task1')">Start Task</button>
                </div>
                <div class="task-card">
                    <h3>Subscribe to Channel</h3>
                    <p>Subscribe to this YouTube channel to earn $1.00</p>
                    <button class="btn btn-primary" onclick="startTask('task2')">Start Task</button>
                </div>
            `;
        }

        function loadTasks() {
            const tasksList = document.getElementById('tasks-list');
            tasksList.innerHTML = `
                <div class="task-card">
                    <div class="video-container">
                        <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        <div class="task-timer" id="task-timer">30s</div>
                    </div>
                    <h3>Watch this YouTube Video</h3>
                    <p>Watch the video for 30 seconds to earn $0.50</p>
                    <button class="subscribe-btn" id="task-button" onclick="startTaskWatching()">Start Watching</button>
                </div>
            `;
        }

        function updateWithdrawPage() {
            if (!userData) return;
            document.getElementById('withdraw-balance').textContent = '$' + (userData.balance || 0).toFixed(2);
        }

        function selectPaymentMethod(element, method) {
            // Remove selected class from all payment methods
            document.querySelectorAll('.payment-method').forEach(item => {
                item.classList.remove('selected');
            });
            
            // Add selected class to clicked element
            element.classList.add('selected');
            selectedPaymentMethod = method;
        }

        async function processWithdrawal() {
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const paymentDetails = document.getElementById('payment-details').value;
            
            if (!amount || amount <= 0) {
                alert('Please enter a valid amount');
                return;
            }
            
            if (!selectedPaymentMethod) {
                alert('Please select a payment method');
                return;
            }
            
            if (!paymentDetails) {
                alert('Please enter payment details');
                return;
            }
            
            if (amount > userData.balance) {
                alert('Insufficient balance');
                return;
            }
            
            showLoading(true);
            
            try {
                // Create withdrawal request in Firestore
                await db.collection('withdrawals').add({
                    userId: currentUser.uid,
                    amount: amount,
                    paymentMethod: selectedPaymentMethod,
                    paymentDetails: paymentDetails,
                    status: 'pending',
                    requestedAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                // Update user balance
                const newBalance = userData.balance - amount;
                await db.collection('users').doc(currentUser.uid).update({
                    balance: newBalance
                });

                // Update local user data
                userData.balance = newBalance;
                
                showLoading(false);
                showSuccess('Withdrawal request submitted successfully! It will be processed within 24 hours.');
                showPage('dashboard-page');
                updateUIWithUserData();
                
            } catch (error) {
                showLoading(false);
                console.error('Withdrawal error:', error);
                showError('Withdrawal failed: ' + error.message);
            }
        }

        function startTaskWatching() {
            const taskButton = document.getElementById('task-button');
            taskButton.disabled = true;
            taskButton.textContent = 'Watching...';
            
            let timeLeft = 30;
            const timerElement = document.getElementById('task-timer');
            
            const timer = setInterval(() => {
                timeLeft--;
                timerElement.textContent = timeLeft + 's';
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    taskButton.textContent = 'Task Completed!';
                    
                    // Reward user
                    completeTask(0.50);
                }
            }, 1000);
        }

        async function startTask(taskId) {
            showLoading(true);
            
            try {
                await completeTask(0.50);
                showLoading(false);
            } catch (error) {
                showLoading(false);
                showError('Task failed: ' + error.message);
            }
        }

        async function completeTask(amount) {
            if (!userData || !currentUser) return;

            const newBalance = (userData.balance || 0) + amount;
            const newTasksCompleted = (userData.tasksCompleted || 0) + 1;
            
            // Update Firestore
            await db.collection('users').doc(currentUser.uid).update({
                balance: newBalance,
                tasksCompleted: newTasksCompleted
            });

            // Update local user data
            userData.balance = newBalance;
            userData.tasksCompleted = newTasksCompleted;
            
            // Update UI
            updateUIWithUserData();
            showSuccess('Task completed! $' + amount.toFixed(2) + ' added to your balance.');
        }

        function adminLogin() {
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            
            // Simple admin login for demo
            if (email === 'admin@ysm.com' && password === 'admin123') {
                showPage('dashboard-page');
                showSuccess('Admin login successful!');
            } else {
                alert('Invalid admin credentials');
            }
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showSuccess(message) {
            alert('‚úÖ ' + message);
        }

        function showError(message) {
            alert('‚ùå ' + message);
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize loader
            const loader = document.getElementById('loader-wrap');
            if (loader) {
                setTimeout(() => {
                    loader.style.opacity = '0';
                    setTimeout(() => {
                        loader.style.display = 'none';
                    }, 1500);
                }, 2000);
            }
            
            console.log('YSM Platform initialized with Firebase');
        });

        // Utility function for PIN inputs
        function moveToNext(input, nextIndex) {
            if (input.value.length === 1) {
                const inputs = input.parentElement.querySelectorAll('.pin-input');
                if (nextIndex < inputs.length) {
                    inputs[nextIndex].focus();
                }
            }
        }
    </script>
</body>
</html>
